{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar jsonld_1 = tslib_1.__importDefault(require(\"jsonld\"));\n\nvar lodash_get_1 = tslib_1.__importDefault(require(\"lodash.get\"));\n\nvar Api_1 = require(\"../Api\");\n\nvar Field_1 = require(\"../Field\");\n\nvar Resource_1 = require(\"../Resource\");\n\nvar Operation_1 = require(\"../Operation\");\n\nvar fetchJsonLd_1 = tslib_1.__importDefault(require(\"./fetchJsonLd\"));\n\nvar getParameters_1 = tslib_1.__importDefault(require(\"./getParameters\"));\n/**\n * Extracts the short name of a resource.\n */\n\n\nfunction guessNameFromUrl(url, entrypointUrl) {\n  return url.substr(entrypointUrl.length + 1);\n}\n/**\n * Finds the description of the class with the given id.\n */\n\n\nfunction findSupportedClass(docs, classToFind) {\n  var supportedClasses = lodash_get_1.default(docs, '[0][\"http://www.w3.org/ns/hydra/core#supportedClass\"]');\n\n  if (!Array.isArray(supportedClasses)) {\n    throw new Error('The API documentation has no \"http://www.w3.org/ns/hydra/core#supportedClass\" key or its value is not an array.');\n  }\n\n  for (var _i = 0, supportedClasses_1 = supportedClasses; _i < supportedClasses_1.length; _i++) {\n    var supportedClass = supportedClasses_1[_i];\n\n    if (supportedClass[\"@id\"] === classToFind) {\n      return supportedClass;\n    }\n  }\n\n  throw new Error(\"The class \\\"\" + classToFind + \"\\\" is not defined in the API documentation.\");\n}\n\nfunction getDocumentationUrlFromHeaders(headers) {\n  var linkHeader = headers.get(\"Link\");\n\n  if (!linkHeader) {\n    throw new Error('The response has no \"Link\" HTTP header.');\n  }\n\n  var matches = /<(.+)>; rel=\"http:\\/\\/www.w3.org\\/ns\\/hydra\\/core#apiDocumentation\"/.exec(linkHeader);\n\n  if (matches === null) {\n    throw new Error('The \"Link\" HTTP header is not of the type \"http://www.w3.org/ns/hydra/core#apiDocumentation\".');\n  }\n\n  return matches[1];\n}\n\nexports.getDocumentationUrlFromHeaders = getDocumentationUrlFromHeaders;\n/**\n * Retrieves Hydra's entrypoint and API docs.\n */\n\nfunction fetchEntrypointAndDocs(entrypointUrl, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var d, docsUrl, documentLoader, docsJsonLd, _a, docs, entrypoint;\n\n    return tslib_1.__generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , fetchJsonLd_1.default(entrypointUrl, options)];\n\n        case 1:\n          d = _b.sent();\n          docsUrl = getDocumentationUrlFromHeaders(d.response.headers);\n\n          documentLoader = function documentLoader(input) {\n            return fetchJsonLd_1.default(input, options);\n          };\n\n          return [4\n          /*yield*/\n          , fetchJsonLd_1.default(docsUrl, options)];\n\n        case 2:\n          docsJsonLd = _b.sent().body;\n          return [4\n          /*yield*/\n          , Promise.all([jsonld_1.default.expand(docsJsonLd, {\n            base: docsUrl,\n            documentLoader: documentLoader\n          }), jsonld_1.default.expand(d.body, {\n            base: entrypointUrl,\n            documentLoader: documentLoader\n          })])];\n\n        case 3:\n          _a = _b.sent(), docs = _a[0], entrypoint = _a[1];\n          return [2\n          /*return*/\n          , {\n            entrypointUrl: entrypointUrl,\n            docsUrl: docsUrl,\n            entrypoint: entrypoint,\n            response: d.response,\n            docs: docs\n          }];\n      }\n    });\n  });\n}\n\nfunction removeTrailingSlash(url) {\n  if (url.endsWith(\"/\")) {\n    url = url.slice(0, -1);\n  }\n\n  return url;\n}\n\nfunction findRelatedClass(docs, property) {\n  // Use the entrypoint property's owl:equivalentClass if available\n  if (Array.isArray(property[\"http://www.w3.org/2000/01/rdf-schema#range\"])) {\n    for (var _i = 0, _a = property[\"http://www.w3.org/2000/01/rdf-schema#range\"]; _i < _a.length; _i++) {\n      var range = _a[_i];\n      var onProperty = lodash_get_1.default(range, '[\"http://www.w3.org/2002/07/owl#equivalentClass\"][0][\"http://www.w3.org/2002/07/owl#onProperty\"][0][\"@id\"]');\n      var allValuesFrom = lodash_get_1.default(range, '[\"http://www.w3.org/2002/07/owl#equivalentClass\"][0][\"http://www.w3.org/2002/07/owl#allValuesFrom\"][0][\"@id\"]');\n\n      if (allValuesFrom && \"http://www.w3.org/ns/hydra/core#member\" === onProperty) {\n        return findSupportedClass(docs, allValuesFrom);\n      }\n    }\n  } // As a fallback, find an operation available on the property of the entrypoint returning the searched type (usually POST)\n\n\n  for (var _b = 0, _c = property[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]; _b < _c.length; _b++) {\n    var entrypointSupportedOperation = _c[_b];\n\n    if (!entrypointSupportedOperation[\"http://www.w3.org/ns/hydra/core#returns\"]) {\n      continue;\n    }\n\n    var returns = lodash_get_1.default(entrypointSupportedOperation, '[\"http://www.w3.org/ns/hydra/core#returns\"][0][\"@id\"]');\n\n    if (\"string\" === typeof returns && 0 !== returns.indexOf(\"http://www.w3.org/ns/hydra/core\")) {\n      return findSupportedClass(docs, returns);\n    }\n  }\n\n  throw new Error(\"Cannot find the class related to \" + property[\"@id\"] + \".\");\n}\n/**\n * Parses Hydra documentation and converts it to an intermediate representation.\n */\n\n\nfunction parseHydraDocumentation(entrypointUrl, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  entrypointUrl = removeTrailingSlash(entrypointUrl);\n  return fetchEntrypointAndDocs(entrypointUrl, options).then(function (_a) {\n    var entrypoint = _a.entrypoint,\n        docs = _a.docs,\n        response = _a.response;\n    var resources = [],\n        fields = [],\n        operations = [];\n    var title = lodash_get_1.default(docs, '[0][\"http://www.w3.org/ns/hydra/core#title\"][0][\"@value\"]', \"API Platform\");\n    var entrypointType = lodash_get_1.default(entrypoint, '[0][\"@type\"][0]');\n\n    if (!entrypointType) {\n      throw new Error('The API entrypoint has no \"@type\" key.');\n    }\n\n    var entrypointClass = findSupportedClass(docs, entrypointType);\n\n    if (!Array.isArray(entrypointClass[\"http://www.w3.org/ns/hydra/core#supportedProperty\"])) {\n      throw new Error('The entrypoint definition has no \"http://www.w3.org/ns/hydra/core#supportedProperty\" key or it is not an array.');\n    }\n\n    var _loop_1 = function _loop_1(properties) {\n      var readableFields = [],\n          resourceFields = [],\n          writableFields = [],\n          resourceOperations = [];\n      var property = lodash_get_1.default(properties, '[\"http://www.w3.org/ns/hydra/core#property\"][0]');\n\n      if (!property) {\n        return \"continue\";\n      } // Add fields\n\n\n      var relatedClass = findRelatedClass(docs, property);\n\n      for (var _i = 0, _a = relatedClass[\"http://www.w3.org/ns/hydra/core#supportedProperty\"]; _i < _a.length; _i++) {\n        var supportedProperties = _a[_i];\n        var supportedProperty = lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#property\"][0]');\n        var range = lodash_get_1.default(supportedProperty, '[\"http://www.w3.org/2000/01/rdf-schema#range\"][0][\"@id\"]', null);\n        var field = new Field_1.Field(supportedProperty[\"http://www.w3.org/2000/01/rdf-schema#label\"][0][\"@value\"], {\n          id: supportedProperty[\"@id\"],\n          range: range,\n          reference: \"http://www.w3.org/ns/hydra/core#Link\" === lodash_get_1.default(property, '[\"@type\"][0]') ? range : null,\n          required: lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#required\"][0][\"@value\"]', false),\n          description: lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#description\"][0][\"@value\"]', \"\"),\n          maxCardinality: lodash_get_1.default(supportedProperty, '[\"http://www.w3.org/2002/07/owl#maxCardinality\"][0][\"@value\"]', null),\n          deprecated: lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n        });\n        fields.push(field);\n        resourceFields.push(field);\n\n        if (lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#readable\"][0][\"@value\"]')) {\n          readableFields.push(field);\n        }\n\n        if (lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#writable\"][0][\"@value\"]')) {\n          writableFields.push(field);\n        }\n      } // parse entrypoint's operations (a.k.a. collection operations)\n\n\n      if (property[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]) {\n        for (var _b = 0, _c = property[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]; _b < _c.length; _b++) {\n          var entrypointOperation = _c[_b];\n\n          if (!entrypointOperation[\"http://www.w3.org/ns/hydra/core#returns\"]) {\n            continue;\n          }\n\n          var range = entrypointOperation[\"http://www.w3.org/ns/hydra/core#returns\"][0][\"@id\"];\n          var operation = new Operation_1.Operation(entrypointOperation[\"http://www.w3.org/2000/01/rdf-schema#label\"][0][\"@value\"], {\n            method: entrypointOperation[\"http://www.w3.org/ns/hydra/core#method\"][0][\"@value\"],\n            expects: entrypointOperation[\"http://www.w3.org/ns/hydra/core#expects\"] && entrypointOperation[\"http://www.w3.org/ns/hydra/core#expects\"][0][\"@id\"],\n            returns: range,\n            types: entrypointOperation[\"@type\"],\n            deprecated: lodash_get_1.default(entrypointOperation, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n          });\n          resourceOperations.push(operation);\n          operations.push(operation);\n        }\n      } // parse resource operations (a.k.a. item operations)\n\n\n      for (var _d = 0, _e = relatedClass[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]; _d < _e.length; _d++) {\n        var supportedOperation = _e[_d];\n\n        if (!supportedOperation[\"http://www.w3.org/ns/hydra/core#returns\"]) {\n          continue;\n        }\n\n        var range = supportedOperation[\"http://www.w3.org/ns/hydra/core#returns\"][0][\"@id\"];\n        var operation = new Operation_1.Operation(supportedOperation[\"http://www.w3.org/2000/01/rdf-schema#label\"][0][\"@value\"], {\n          method: supportedOperation[\"http://www.w3.org/ns/hydra/core#method\"][0][\"@value\"],\n          expects: supportedOperation[\"http://www.w3.org/ns/hydra/core#expects\"] && supportedOperation[\"http://www.w3.org/ns/hydra/core#expects\"][0][\"@id\"],\n          returns: range,\n          types: supportedOperation[\"@type\"],\n          deprecated: lodash_get_1.default(supportedOperation, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n        });\n        resourceOperations.push(operation);\n        operations.push(operation);\n      }\n\n      var url = lodash_get_1.default(entrypoint, \"[0][\\\"\" + property[\"@id\"] + \"\\\"][0][\\\"@id\\\"]\");\n\n      if (!url) {\n        throw new Error(\"Unable to find the URL for \\\"\" + property[\"@id\"] + \"\\\".\");\n      }\n\n      var resource = new Resource_1.Resource(guessNameFromUrl(url, entrypointUrl), url, {\n        id: relatedClass[\"@id\"],\n        title: lodash_get_1.default(relatedClass, '[\"http://www.w3.org/ns/hydra/core#title\"][0][\"@value\"]', \"\"),\n        fields: resourceFields,\n        readableFields: readableFields,\n        writableFields: writableFields,\n        operations: resourceOperations,\n        deprecated: lodash_get_1.default(relatedClass, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n      });\n      resource.parameters = [];\n\n      resource.getParameters = function () {\n        return getParameters_1.default(resource, options);\n      };\n\n      resources.push(resource);\n    }; // Add resources\n\n\n    for (var _i = 0, _b = entrypointClass[\"http://www.w3.org/ns/hydra/core#supportedProperty\"]; _i < _b.length; _i++) {\n      var properties = _b[_i];\n\n      _loop_1(properties);\n    }\n\n    var _loop_2 = function _loop_2(field) {\n      if (null !== field.reference) {\n        field.reference = resources.find(function (resource) {\n          return resource.id === field.reference;\n        }) || null;\n      }\n    }; // Resolve references\n\n\n    for (var _c = 0, fields_1 = fields; _c < fields_1.length; _c++) {\n      var field = fields_1[_c];\n\n      _loop_2(field);\n    }\n\n    return {\n      api: new Api_1.Api(entrypointUrl, {\n        title: title,\n        resources: resources\n      }),\n      response: response,\n      status: response.status\n    };\n  }, function (data) {\n    return Promise.reject({\n      api: new Api_1.Api(entrypointUrl, {\n        resources: []\n      }),\n      error: data,\n      response: data.response,\n      status: lodash_get_1.default(data.response, \"status\")\n    });\n  });\n}\n\nexports.default = parseHydraDocumentation;","map":{"version":3,"sources":["../../src/hydra/parseHydraDocumentation.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar jsonld_1 = tslib_1.__importDefault(require(\"jsonld\"));\nvar lodash_get_1 = tslib_1.__importDefault(require(\"lodash.get\"));\nvar Api_1 = require(\"../Api\");\nvar Field_1 = require(\"../Field\");\nvar Resource_1 = require(\"../Resource\");\nvar Operation_1 = require(\"../Operation\");\nvar fetchJsonLd_1 = tslib_1.__importDefault(require(\"./fetchJsonLd\"));\nvar getParameters_1 = tslib_1.__importDefault(require(\"./getParameters\"));\n/**\n * Extracts the short name of a resource.\n */\nfunction guessNameFromUrl(url, entrypointUrl) {\n    return url.substr(entrypointUrl.length + 1);\n}\n/**\n * Finds the description of the class with the given id.\n */\nfunction findSupportedClass(docs, classToFind) {\n    var supportedClasses = lodash_get_1.default(docs, '[0][\"http://www.w3.org/ns/hydra/core#supportedClass\"]');\n    if (!Array.isArray(supportedClasses)) {\n        throw new Error('The API documentation has no \"http://www.w3.org/ns/hydra/core#supportedClass\" key or its value is not an array.');\n    }\n    for (var _i = 0, supportedClasses_1 = supportedClasses; _i < supportedClasses_1.length; _i++) {\n        var supportedClass = supportedClasses_1[_i];\n        if (supportedClass[\"@id\"] === classToFind) {\n            return supportedClass;\n        }\n    }\n    throw new Error(\"The class \\\"\" + classToFind + \"\\\" is not defined in the API documentation.\");\n}\nfunction getDocumentationUrlFromHeaders(headers) {\n    var linkHeader = headers.get(\"Link\");\n    if (!linkHeader) {\n        throw new Error('The response has no \"Link\" HTTP header.');\n    }\n    var matches = /<(.+)>; rel=\"http:\\/\\/www.w3.org\\/ns\\/hydra\\/core#apiDocumentation\"/.exec(linkHeader);\n    if (matches === null) {\n        throw new Error('The \"Link\" HTTP header is not of the type \"http://www.w3.org/ns/hydra/core#apiDocumentation\".');\n    }\n    return matches[1];\n}\nexports.getDocumentationUrlFromHeaders = getDocumentationUrlFromHeaders;\n/**\n * Retrieves Hydra's entrypoint and API docs.\n */\nfunction fetchEntrypointAndDocs(entrypointUrl, options) {\n    if (options === void 0) { options = {}; }\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var d, docsUrl, documentLoader, docsJsonLd, _a, docs, entrypoint;\n        return tslib_1.__generator(this, function (_b) {\n            switch (_b.label) {\n                case 0: return [4 /*yield*/, fetchJsonLd_1.default(entrypointUrl, options)];\n                case 1:\n                    d = _b.sent();\n                    docsUrl = getDocumentationUrlFromHeaders(d.response.headers);\n                    documentLoader = function (input) {\n                        return fetchJsonLd_1.default(input, options);\n                    };\n                    return [4 /*yield*/, fetchJsonLd_1.default(docsUrl, options)];\n                case 2:\n                    docsJsonLd = (_b.sent()).body;\n                    return [4 /*yield*/, Promise.all([\n                            jsonld_1.default.expand(docsJsonLd, {\n                                base: docsUrl,\n                                documentLoader: documentLoader\n                            }),\n                            jsonld_1.default.expand(d.body, {\n                                base: entrypointUrl,\n                                documentLoader: documentLoader\n                            })\n                        ])];\n                case 3:\n                    _a = _b.sent(), docs = _a[0], entrypoint = _a[1];\n                    return [2 /*return*/, {\n                            entrypointUrl: entrypointUrl,\n                            docsUrl: docsUrl,\n                            entrypoint: entrypoint,\n                            response: d.response,\n                            docs: docs\n                        }];\n            }\n        });\n    });\n}\nfunction removeTrailingSlash(url) {\n    if (url.endsWith(\"/\")) {\n        url = url.slice(0, -1);\n    }\n    return url;\n}\nfunction findRelatedClass(docs, property) {\n    // Use the entrypoint property's owl:equivalentClass if available\n    if (Array.isArray(property[\"http://www.w3.org/2000/01/rdf-schema#range\"])) {\n        for (var _i = 0, _a = property[\"http://www.w3.org/2000/01/rdf-schema#range\"]; _i < _a.length; _i++) {\n            var range = _a[_i];\n            var onProperty = lodash_get_1.default(range, '[\"http://www.w3.org/2002/07/owl#equivalentClass\"][0][\"http://www.w3.org/2002/07/owl#onProperty\"][0][\"@id\"]');\n            var allValuesFrom = lodash_get_1.default(range, '[\"http://www.w3.org/2002/07/owl#equivalentClass\"][0][\"http://www.w3.org/2002/07/owl#allValuesFrom\"][0][\"@id\"]');\n            if (allValuesFrom &&\n                \"http://www.w3.org/ns/hydra/core#member\" === onProperty) {\n                return findSupportedClass(docs, allValuesFrom);\n            }\n        }\n    }\n    // As a fallback, find an operation available on the property of the entrypoint returning the searched type (usually POST)\n    for (var _b = 0, _c = property[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]; _b < _c.length; _b++) {\n        var entrypointSupportedOperation = _c[_b];\n        if (!entrypointSupportedOperation[\"http://www.w3.org/ns/hydra/core#returns\"]) {\n            continue;\n        }\n        var returns = lodash_get_1.default(entrypointSupportedOperation, '[\"http://www.w3.org/ns/hydra/core#returns\"][0][\"@id\"]');\n        if (\"string\" === typeof returns &&\n            0 !== returns.indexOf(\"http://www.w3.org/ns/hydra/core\")) {\n            return findSupportedClass(docs, returns);\n        }\n    }\n    throw new Error(\"Cannot find the class related to \" + property[\"@id\"] + \".\");\n}\n/**\n * Parses Hydra documentation and converts it to an intermediate representation.\n */\nfunction parseHydraDocumentation(entrypointUrl, options) {\n    if (options === void 0) { options = {}; }\n    entrypointUrl = removeTrailingSlash(entrypointUrl);\n    return fetchEntrypointAndDocs(entrypointUrl, options).then(function (_a) {\n        var entrypoint = _a.entrypoint, docs = _a.docs, response = _a.response;\n        var resources = [], fields = [], operations = [];\n        var title = lodash_get_1.default(docs, '[0][\"http://www.w3.org/ns/hydra/core#title\"][0][\"@value\"]', \"API Platform\");\n        var entrypointType = lodash_get_1.default(entrypoint, '[0][\"@type\"][0]');\n        if (!entrypointType) {\n            throw new Error('The API entrypoint has no \"@type\" key.');\n        }\n        var entrypointClass = findSupportedClass(docs, entrypointType);\n        if (!Array.isArray(entrypointClass[\"http://www.w3.org/ns/hydra/core#supportedProperty\"])) {\n            throw new Error('The entrypoint definition has no \"http://www.w3.org/ns/hydra/core#supportedProperty\" key or it is not an array.');\n        }\n        var _loop_1 = function (properties) {\n            var readableFields = [], resourceFields = [], writableFields = [], resourceOperations = [];\n            var property = lodash_get_1.default(properties, '[\"http://www.w3.org/ns/hydra/core#property\"][0]');\n            if (!property) {\n                return \"continue\";\n            }\n            // Add fields\n            var relatedClass = findRelatedClass(docs, property);\n            for (var _i = 0, _a = relatedClass[\"http://www.w3.org/ns/hydra/core#supportedProperty\"]; _i < _a.length; _i++) {\n                var supportedProperties = _a[_i];\n                var supportedProperty = lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#property\"][0]');\n                var range = lodash_get_1.default(supportedProperty, '[\"http://www.w3.org/2000/01/rdf-schema#range\"][0][\"@id\"]', null);\n                var field = new Field_1.Field(supportedProperty[\"http://www.w3.org/2000/01/rdf-schema#label\"][0][\"@value\"], {\n                    id: supportedProperty[\"@id\"],\n                    range: range,\n                    reference: \"http://www.w3.org/ns/hydra/core#Link\" ===\n                        lodash_get_1.default(property, '[\"@type\"][0]')\n                        ? range\n                        : null,\n                    required: lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#required\"][0][\"@value\"]', false),\n                    description: lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#description\"][0][\"@value\"]', \"\"),\n                    maxCardinality: lodash_get_1.default(supportedProperty, '[\"http://www.w3.org/2002/07/owl#maxCardinality\"][0][\"@value\"]', null),\n                    deprecated: lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n                });\n                fields.push(field);\n                resourceFields.push(field);\n                if (lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#readable\"][0][\"@value\"]')) {\n                    readableFields.push(field);\n                }\n                if (lodash_get_1.default(supportedProperties, '[\"http://www.w3.org/ns/hydra/core#writable\"][0][\"@value\"]')) {\n                    writableFields.push(field);\n                }\n            }\n            // parse entrypoint's operations (a.k.a. collection operations)\n            if (property[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]) {\n                for (var _b = 0, _c = property[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]; _b < _c.length; _b++) {\n                    var entrypointOperation = _c[_b];\n                    if (!entrypointOperation[\"http://www.w3.org/ns/hydra/core#returns\"]) {\n                        continue;\n                    }\n                    var range = entrypointOperation[\"http://www.w3.org/ns/hydra/core#returns\"][0][\"@id\"];\n                    var operation = new Operation_1.Operation(entrypointOperation[\"http://www.w3.org/2000/01/rdf-schema#label\"][0][\"@value\"], {\n                        method: entrypointOperation[\"http://www.w3.org/ns/hydra/core#method\"][0][\"@value\"],\n                        expects: entrypointOperation[\"http://www.w3.org/ns/hydra/core#expects\"] &&\n                            entrypointOperation[\"http://www.w3.org/ns/hydra/core#expects\"][0][\"@id\"],\n                        returns: range,\n                        types: entrypointOperation[\"@type\"],\n                        deprecated: lodash_get_1.default(entrypointOperation, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n                    });\n                    resourceOperations.push(operation);\n                    operations.push(operation);\n                }\n            }\n            // parse resource operations (a.k.a. item operations)\n            for (var _d = 0, _e = relatedClass[\"http://www.w3.org/ns/hydra/core#supportedOperation\"]; _d < _e.length; _d++) {\n                var supportedOperation = _e[_d];\n                if (!supportedOperation[\"http://www.w3.org/ns/hydra/core#returns\"]) {\n                    continue;\n                }\n                var range = supportedOperation[\"http://www.w3.org/ns/hydra/core#returns\"][0][\"@id\"];\n                var operation = new Operation_1.Operation(supportedOperation[\"http://www.w3.org/2000/01/rdf-schema#label\"][0][\"@value\"], {\n                    method: supportedOperation[\"http://www.w3.org/ns/hydra/core#method\"][0][\"@value\"],\n                    expects: supportedOperation[\"http://www.w3.org/ns/hydra/core#expects\"] &&\n                        supportedOperation[\"http://www.w3.org/ns/hydra/core#expects\"][0][\"@id\"],\n                    returns: range,\n                    types: supportedOperation[\"@type\"],\n                    deprecated: lodash_get_1.default(supportedOperation, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n                });\n                resourceOperations.push(operation);\n                operations.push(operation);\n            }\n            var url = lodash_get_1.default(entrypoint, \"[0][\\\"\" + property[\"@id\"] + \"\\\"][0][\\\"@id\\\"]\");\n            if (!url) {\n                throw new Error(\"Unable to find the URL for \\\"\" + property[\"@id\"] + \"\\\".\");\n            }\n            var resource = new Resource_1.Resource(guessNameFromUrl(url, entrypointUrl), url, {\n                id: relatedClass[\"@id\"],\n                title: lodash_get_1.default(relatedClass, '[\"http://www.w3.org/ns/hydra/core#title\"][0][\"@value\"]', \"\"),\n                fields: resourceFields,\n                readableFields: readableFields,\n                writableFields: writableFields,\n                operations: resourceOperations,\n                deprecated: lodash_get_1.default(relatedClass, '[\"http://www.w3.org/2002/07/owl#deprecated\"][0][\"@value\"]', false)\n            });\n            resource.parameters = [];\n            resource.getParameters = function () {\n                return getParameters_1.default(resource, options);\n            };\n            resources.push(resource);\n        };\n        // Add resources\n        for (var _i = 0, _b = entrypointClass[\"http://www.w3.org/ns/hydra/core#supportedProperty\"]; _i < _b.length; _i++) {\n            var properties = _b[_i];\n            _loop_1(properties);\n        }\n        var _loop_2 = function (field) {\n            if (null !== field.reference) {\n                field.reference =\n                    resources.find(function (resource) { return resource.id === field.reference; }) ||\n                        null;\n            }\n        };\n        // Resolve references\n        for (var _c = 0, fields_1 = fields; _c < fields_1.length; _c++) {\n            var field = fields_1[_c];\n            _loop_2(field);\n        }\n        return {\n            api: new Api_1.Api(entrypointUrl, { title: title, resources: resources }),\n            response: response,\n            status: response.status\n        };\n    }, function (data) {\n        return Promise.reject({\n            api: new Api_1.Api(entrypointUrl, { resources: [] }),\n            error: data,\n            response: data.response,\n            status: lodash_get_1.default(data.response, \"status\")\n        });\n    });\n}\nexports.default = parseHydraDocumentation;\n//# sourceMappingURL=parseHydraDocumentation.js.map"]},"metadata":{},"sourceType":"script"}